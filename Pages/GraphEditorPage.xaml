<Page
    x:Class="BBIHardwareSupport.MDM.IntuneConfigManager.Pages.GraphEditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:graph="using:BBIHardwareSupport.MDM.Models.Graph"
    mc:Ignorable="d">

    <Grid ColumnSpacing="12">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="420"/>
            <!-- your existing lists/controls -->
            <ColumnDefinition Width="*"/>
            <!-- graph -->
        </Grid.ColumnDefinitions>
        <!-- LEFT PANE -->
        <!-- Toolbar -->
        <CommandBar Grid.Row="0" Grid.ColumnSpan="2">
            <AppBarButton Icon="Refresh" Label="Reload" Command="{x:Bind VM.ReloadCommand}"/>
            <AppBarSeparator/>
            <AppBarButton Icon="Page2" Label="Preview" Command="{x:Bind VM.PreviewCommand}"/>
            <AppBarButton Icon="Accept" Label="Apply" Command="{x:Bind VM.ApplyCommand}"/>
            <AppBarButton Icon="Clear" Label="Clear Changes" Command="{x:Bind VM.ClearChangesCommand}"/>
            <AppBarSeparator/>
            <AppBarElementContainer>
                <ProgressRing IsActive="{x:Bind VM.IsBusy}" Width="20" Height="20"/>
            </AppBarElementContainer>
        </CommandBar>

        <!-- Left: SmartGroup & Assigned -->
        <StackPanel Grid.Row="1" Grid.Column="0" Spacing="12" Padding="12">
            <TextBlock Text="Smart Group" Style="{StaticResource HeaderTextBlockStyle}"/>
            <ComboBox ItemsSource="{x:Bind VM.SmartGroups}" SelectedItem="{x:Bind VM.SelectedSmartGroup, Mode=TwoWay}" DisplayMemberPath="Name"/>

            <TextBlock Text="Assigned Artifacts" Margin="0,12,0,0"/>
            <ListView ItemsSource="{x:Bind VM.AssignedArtifacts}" SelectedItem="{x:Bind VM.SelectedAssignedArtifact, Mode=TwoWay}" Height="260">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="graph:GraphNode">
                        <TextBlock Text="{x:Bind Name}"/>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            <Button Content="Stage Remove" Command="{x:Bind VM.RemoveLinkCommand}" />
        </StackPanel>

        <!-- Right: Available, ChangeSet, Preview -->
        <StackPanel Grid.Row="1" Grid.Column="1" Spacing="12" Padding="12">
            <TextBlock Text="Available Artifacts" Style="{StaticResource HeaderTextBlockStyle}"/>
            <ListView ItemsSource="{x:Bind VM.AvailableArtifacts}" SelectedItem="{x:Bind VM.SelectedAvailableArtifact, Mode=TwoWay}" Height="200">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="graph:GraphNode">
                        <TextBlock Text="{x:Bind Name}"/>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Stage Assign" Command="{x:Bind VM.AddAssignCommand}"/>
                <Button Content="Stage Exclude" Command="{x:Bind VM.AddExcludeCommand}"/>
            </StackPanel>

            <TextBlock Text="Pending Changes" Margin="0,12,0,0"/>
            <ListView ItemsSource="{x:Bind VM.ChangeSet}" Height="200">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="graph:PendingChange">
                        <TextBlock Text="{x:Bind ToString()}"/>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <Expander Header="Impact Preview" IsExpanded="False">
                <StackPanel>
                    <TextBlock Text="Devices Gaining:" FontWeight="SemiBold"/>
                    <ItemsControl ItemsSource="{x:Bind VM.PreviewResult.DevicesGaining}"/>
                    <TextBlock Text="Devices Losing:" Margin="0,8,0,0" FontWeight="SemiBold"/>
                    <ItemsControl ItemsSource="{x:Bind VM.PreviewResult.DevicesLosing}"/>
                    <TextBlock Text="Warnings:" Margin="0,8,0,0" FontWeight="SemiBold"/>
                    <ItemsControl ItemsSource="{x:Bind VM.PreviewResult.Warnings}"/>
                </StackPanel>
            </Expander>
        </StackPanel>
        <!-- RIGHT: Graph -->
        <Grid Grid.Column="1">
            <WebView2 x:Name="GraphView"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch" />
        </Grid>
    </Grid>
</Page>
