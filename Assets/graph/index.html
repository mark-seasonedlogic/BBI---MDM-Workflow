<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Graph Test</title>
    <style>
        /* Make sure the container actually has size */
        html, body, #cy {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <!-- Use local copy if your network blocks CDNs.
         Place cytoscape.min.js in Assets/graph and change src to "./cytoscape.min.js" -->
    <script src="https://unpkg.com/cytoscape@3.28.0/dist/cytoscape.min.js"></script>
</head>
<body>
    <div id="cy"></div>

    <script>
        // 1) Create the instance
        const cy = cytoscape({
            container: document.getElementById('cy'),
            layout: { name: 'breadthfirst', directed: true },
            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'text-wrap': 'wrap',       // wrap long labels
                        'text-max-width': 120,     // tweak width as needed (80–200)
                        'width': 'label',          // size node to its label
                        'height': 'label',
                        'padding': '8px',          // breathing room around text
                        'font-size': 12
                    }
                },
                {
                    selector: 'node[type="OG"]',
                    style: { 'background-color': '#1976D2', 'shape': 'round-rectangle', 'color': '#fff' }
                },
                {
                    selector: 'node[type="SmartGroup"]',
                    style: { 'background-color': '#7B1FA2', 'shape': 'round-rectangle', 'color': '#fff' }
                },
                {
                    selector: 'node[type="User"]',
                    style: { 'background-color': '#455A64', 'shape': 'ellipse', 'color': '#fff' }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#9E9E9E',
                        'target-arrow-shape': 'triangle',
                        'target-arrow-color': '#9E9E9E',
                        'curve-style': 'bezier',
                        'label': 'data(label)',
                        'font-size': 9,
                        'text-rotation': 'autorotate'
                    }
                },
                // (optional) pending change visuals if you post classes from C#
                {
                    selector: 'edge.pendingAdd',
                    style: { 'line-style': 'dashed', 'line-color': '#4CAF50', 'target-arrow-color': '#4CAF50' }
                },
                {
                    selector: 'edge.pendingRemove',
                    style: { 'line-style': 'dashed', 'line-color': '#E53935', 'target-arrow-color': '#E53935' }
                },
                {
                    selector: 'node.available',
                    style: { 'opacity': 0.35 }
                }
            ]
        });


        // 2) Add a tiny starter graph so you see something immediately
        cy.add([
            { data: { id: 'BBI', label: 'Bloomin Brands', type: 'OG' } },
            { data: { id: 'OBS', label: 'Outback-POS', type: 'SmartGroup' } },
            { data: { id: 'edge1', source: 'BBI', target: 'OBS', label: 'Contains' } }
        ]);
        cy.layout({ name: 'breadthfirst', directed: true }).run();
        cy.fit();

        // 3) Listen for data from C# (WebView2)
        function render(elements) {
            cy.elements().remove();
            cy.add(elements);
            cy.layout({ name: 'breadthfirst', directed: true }).run();
            cy.fit();
        }

        // WebView2 messaging hook
        if (window.chrome?.webview) {
            window.chrome.webview.addEventListener('message', e => {
                try { render(JSON.parse(e.data)); } catch (err) { console.error(err); }
            });
            // Tell host we are ready to receive data
            window.chrome.webview.postMessage('ready');
        }
    </script>
</body>
</html>
